<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEANBOOK Rental</title>
    <link id="dynamic-favicon" rel="icon" href="">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg-dark: #050505; --accent: #ffffff; --glass: rgba(255, 255, 255, 0.03); }
        body { font-family: 'Inter', 'Kanit', sans-serif; background-color: var(--bg-dark); color: #ffffff; scroll-behavior: smooth; }
        
        .glass-card { 
            background: var(--glass); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); 
            border-radius: 1.5rem; 
        }
        
        .glass-card:hover { 
            border-color: rgba(255, 255, 255, 0.3); 
            transform: translateY(-10px); 
            background: rgba(255, 255, 255, 0.05); 
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.5); 
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }

        .banner-image {
            width: 100%;
            height: auto;
            margin: 0;
            display: block;
            background: #111;
        }

        select option {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        /* ปุ่มปรับขนาดการ์ดสไตล์มินิมอล */
        .size-btn {
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.3);
            cursor: pointer;
        }
        .size-btn.active {
            color: #ffffff;
            background-color: rgba(255, 255, 255, 0.08);
        }
        .size-btn svg rect {
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
        }
        .size-btn.active svg rect {
            fill: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Sidebar Overlay (พื้นหลังสีดำเวลาเปิดเมนู) -->
    <div id="sidebarOverlay" onclick="toggleMenu()" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[150] hidden opacity-0 transition-opacity duration-300"></div>
    
    <!-- Sidebar Menu (แถบเมนูด้านซ้าย) -->
    <aside id="sidebarMenu" class="fixed top-0 left-0 h-full w-72 bg-zinc-950 border-r border-white/10 z-[200] transform -translate-x-full transition-transform duration-300 flex flex-col shadow-2xl">
        <div class="h-20 flex items-center justify-between px-6 border-b border-white/10">
            <span class="text-white font-black tracking-widest uppercase text-lg flex items-center gap-3">
                <i data-lucide="dices" class="w-5 h-5"></i> Menu
            </span>
            <button onclick="toggleMenu()" class="text-zinc-500 hover:text-white p-2 transition-colors rounded-xl hover:bg-white/5">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        <div class="flex flex-col py-6 px-4 gap-2">
            <a href="#" class="flex items-center gap-4 px-4 py-3.5 text-zinc-400 hover:text-white hover:bg-white/5 rounded-xl transition-all group">
                <i data-lucide="book-open" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                <span class="font-bold text-sm tracking-wide">วิธีเช่าบอร์ดเกม</span>
            </a>
            <a href="#" class="flex items-center gap-4 px-4 py-3.5 text-zinc-400 hover:text-white hover:bg-white/5 rounded-xl transition-all group">
                <i data-lucide="shield-alert" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                <span class="font-bold text-sm tracking-wide">กฎในการเช่าบอร์ดเกม</span>
            </a>
            <a href="#" class="flex items-center gap-4 px-4 py-3.5 text-zinc-400 hover:text-white hover:bg-white/5 rounded-xl transition-all group">
                <i data-lucide="user" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                <span class="font-bold text-sm tracking-wide">ข้อมูลสมาชิก</span>
            </a>
        </div>
        <!-- เพิ่มพื้นที่ด้านล่างเผื่ออนาคต -->
        <div class="mt-auto p-6 border-t border-white/10">
            <p class="text-[10px] text-zinc-600 uppercase tracking-widest text-center">Meanbook Rental System</p>
        </div>
    </aside>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-[100] border-b border-white/5 bg-black/80 backdrop-blur-xl">
        <!-- ปรับ max-w ให้เป็น 1600px เพื่อให้ขอบซ้ายขวาตรงกับการ์ดด้านล่าง -->
        <div class="max-w-[1600px] mx-auto px-6 h-20 flex items-center justify-between">
            
            <!-- ส่วนด้านซ้าย: ปุ่มเมนู + โลโก้ -->
            <div class="flex items-center gap-4 sm:gap-6">
                <!-- ปุ่มเมนูขีดๆ (Hamburger Menu) ใส่ onclick เพื่อเปิดเมนู -->
                <button onclick="toggleMenu()" class="text-zinc-400 hover:text-white transition-colors cursor-pointer p-1">
                    <i data-lucide="menu" class="w-6 h-6 sm:w-7 sm:h-7"></i>
                </button>

                <!-- โลโก้และชื่อเว็บ -->
                <div class="flex items-center gap-3 sm:gap-4 group cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="w-10 h-10 sm:w-11 sm:h-11 bg-white rounded-xl flex items-center justify-center shadow-lg transition-transform group-hover:scale-105">
                        <i data-lucide="dices" class="text-black w-5 h-5 sm:w-6 sm:h-6"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-lg sm:text-xl font-black tracking-tighter uppercase leading-none text-white">Meanbook</span>
                        <span class="text-[8px] sm:text-[10px] text-zinc-500 uppercase tracking-[0.3em] font-bold">Rental Experience</span>
                    </div>
                </div>
            </div>

            <!-- ส่วนด้านขวา: ปุ่ม Line OA & Login -->
            <div class="flex items-center gap-2 sm:gap-3">
                <a href="https://line.me/ti/p/@meanbook" target="_blank" class="bg-white/5 hover:bg-white/10 text-white px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest border border-white/10 flex items-center gap-1.5 sm:gap-2 transition-all">
                    <i data-lucide="message-circle" class="w-3 h-3 text-green-400"></i> Line OA
                </a>
                <a href="login.html" class="bg-white/5 hover:bg-white/10 text-white px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest border border-white/10 flex items-center gap-1.5 sm:gap-2 transition-all">
                    <i data-lucide="user" class="w-3 h-3"></i> Login
                </a>
            </div>
        </div>
    </nav>

    <!-- Header Banner -->
    <section class="pt-20 pb-0 relative overflow-hidden">
        <div class="fade-in w-full">
            <img id="mainBanner" src="" alt="Meanbook Rental Banner" class="banner-image opacity-0 transition-opacity duration-500">
        </div>
    </section>

    <!-- Main Content -->
    <main class="max-w-[1600px] mx-auto px-6 pt-12 pb-20 flex-grow w-full">
        <!-- Search Controls -->
        <section id="games" class="mb-20">
            <div class="flex flex-col gap-6 mb-12">
                <!-- แถบค้นหา และ สถานะ -->
                <div class="flex flex-col lg:flex-row gap-6">
                    <div class="relative flex-1">
                        <i data-lucide="search" class="absolute left-6 top-1/2 -translate-y-1/2 text-zinc-600 w-5 h-5"></i>
                        <input type="text" id="searchInput" placeholder="ค้นหาชื่อเกม..." class="w-full bg-zinc-900/40 border border-white/10 rounded-2xl py-6 pl-16 pr-8 focus:outline-none focus:border-white/30 transition-all text-white text-lg">
                    </div>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <!-- เมนูกรองสถานะ ปรับดีไซน์ให้กระชับ (w-max) และมีลูกศรเหมือนปุ่มเรียงลำดับ -->
                        <div class="relative flex items-center bg-white/5 border border-white/10 rounded-2xl hover:bg-white/10 transition-colors w-max">
                            <select id="statusFilter" class="bg-transparent border-none pl-6 pr-10 py-4 lg:py-0 focus:outline-none text-sm font-bold tracking-wider text-white appearance-none cursor-pointer h-full w-full">
                                <option value="all">สถานะทั้งหมด</option>
                                <option value="ว่าง">ว่าง</option>
                                <option value="ติดเช่า">ติดเช่า</option>
                                <option value="กำลังดำเนินการ">กำลังดำเนินการ</option>
                            </select>
                            <i data-lucide="chevron-down" class="absolute right-3 w-5 h-5 text-zinc-400 pointer-events-none"></i>
                        </div>
                    </div>
                </div>

                <!-- มุมมองและขนาดการ์ด & จัดเรียงลำดับ -->
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex flex-wrap items-center gap-4">
                        <!-- ปุ่มปรับขนาดการ์ด (กำหนดความสูงให้คงที่ 48px) -->
                        <div class="flex items-center bg-white/5 border border-white/10 p-1 rounded-2xl h-[48px]">
                            <!-- ขนาดมาตรฐาน (1 ช่อง) -->
                            <button onclick="changeCardSize('normal')" id="btn-normal" class="size-btn active w-11 h-full rounded-xl" title="ขนาดมาตรฐาน">
                                <svg width="20" height="20" viewBox="0 0 24 24">
                                    <rect x="4" y="4" width="16" height="16" rx="2" />
                                </svg>
                            </button>
                            <!-- ขนาดเล็ก (4 ช่อง 2x2) -->
                            <button onclick="changeCardSize('small')" id="btn-small" class="size-btn w-11 h-full rounded-xl" title="ขนาดเล็ก">
                                <svg width="20" height="20" viewBox="0 0 24 24">
                                    <rect x="3" y="3" width="8" height="8" rx="1.5" />
                                    <rect x="13" y="3" width="8" height="8" rx="1.5" />
                                    <rect x="3" y="13" width="8" height="8" rx="1.5" />
                                    <rect x="13" y="13" width="8" height="8" rx="1.5" />
                                </svg>
                            </button>
                            <!-- ขนาดจิ๋ว (6 ช่อง 3x2) -->
                            <button onclick="changeCardSize('compact')" id="btn-compact" class="size-btn w-11 h-full rounded-xl" title="ขนาดจิ๋ว">
                                <svg width="22" height="20" viewBox="0 0 24 24">
                                    <rect x="2" y="5" width="5.5" height="5.5" rx="1" />
                                    <rect x="9.25" y="5" width="5.5" height="5.5" rx="1" />
                                    <rect x="16.5" y="5" width="5.5" height="5.5" rx="1" />
                                    <rect x="2" y="13.5" width="5.5" height="5.5" rx="1" />
                                    <rect x="9.25" y="13.5" width="5.5" height="5.5" rx="1" />
                                    <rect x="16.5" y="13.5" width="5.5" height="5.5" rx="1" />
                                </svg>
                            </button>
                        </div>

                        <!-- เมนูสำหรับเรียงลำดับข้อมูล (ปรับให้กระชับพอดีข้อความที่สุด) -->
                        <div class="relative flex items-center bg-white/5 border border-white/10 rounded-2xl h-[48px] hover:bg-white/10 transition-colors w-max">
                            <select id="sortFilter" class="bg-transparent border-none pl-4 pr-8 focus:outline-none text-[11px] sm:text-xs font-bold tracking-wider text-white appearance-none cursor-pointer h-full">
                                <option value="az">เรียง A-Z</option>
                                <option value="za">เรียง Z-A</option>
                                <option value="newest">ใหม่ล่าสุด</option>
                            </select>
                            <i data-lucide="chevron-down" class="absolute right-2.5 w-4 h-4 text-zinc-400 pointer-events-none"></i>
                        </div>
                    </div>
                    
                    <div id="resultCount" class="text-[11px] uppercase font-bold text-zinc-600 tracking-widest"></div>
                </div>
            </div>

            <!-- Loader -->
            <div id="loading" class="flex flex-col items-center justify-center py-40">
                <div class="w-12 h-12 border-2 border-zinc-800 border-t-white rounded-full animate-spin mb-6"></div>
                <p id="loadingText" class="text-zinc-600 font-bold uppercase tracking-widest text-[10px]">Syncing Inventory...</p>
            </div>

            <!-- Grid Display -->
            <div id="gamesGrid" class="grid gap-6 md:gap-10"></div>
            <div id="noResults" class="hidden text-center py-40"><p class="text-zinc-500 text-xl font-light">ไม่พบเกมที่คุณค้นหาครับ คุณเม </p></div>

            <!-- Pagination Controls -->
            <div id="paginationControls" class="flex justify-center items-center gap-4 mt-16"></div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer class="border-t border-white/10 bg-black/60 pt-16 pb-8 mt-auto">
        <div class="max-w-[1600px] mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between gap-12 mb-12">
                <!-- Brand Info -->
                <div class="flex flex-col gap-4 max-w-sm">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-lg">
                            <i data-lucide="dices" class="text-black w-6 h-6"></i>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-xl font-black tracking-tighter uppercase leading-none text-white">Meanbook</span>
                            <span class="text-[10px] text-zinc-500 uppercase tracking-[0.3em] font-bold">Rental Experience</span>
                        </div>
                    </div>
                    <p class="text-zinc-500 text-sm leading-relaxed mt-2">
                        บริการเช่าบอร์ดเกมจาก MEANBOOK ที่พร้อมให้คุณเช่าบอร์ดเกมไปเล่นที่บ้านได้
                    </p>
                </div>

                <!-- Contact Info -->
                <div class="flex flex-col gap-4 md:items-end">
                    <h4 class="text-white font-bold uppercase tracking-widest text-xs mb-2">ติดต่อสอบถาม</h4>
                    <a href="https://line.me/ti/p/@meanbook" target="_blank" class="text-zinc-500 hover:text-green-400 text-sm transition-colors flex items-center gap-3 w-fit">
                        <i data-lucide="message-circle" class="w-4 h-4 shrink-0"></i> Line OA: @meanbook
                    </a>
                    <p class="text-zinc-500 text-sm flex items-center gap-3 w-fit">
                        <i data-lucide="phone" class="w-4 h-4 shrink-0"></i> 064-186-9998
                    </p>
                    <p class="text-zinc-500 text-sm flex items-start gap-3 w-fit md:text-right">
                        <i data-lucide="map-pin" class="w-4 h-4 mt-0.5 shrink-0"></i> 
                        <span class="max-w-[250px] md:max-w-xs">110/15 ม.2 ต.ปากเกร็ด อ.ปากเกร็ด จ.นนทบุรี 11120</span>
                    </p>
                </div>
            </div>
            <div class="pt-8 border-t border-white/5 flex justify-center items-center">
                <p class="text-zinc-600 text-xs tracking-widest uppercase text-center">Copyright © 2026 Meanbook. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSboMt8lu6Md3_4KGIZ3QoBCeCO-3RGCg0TVnD4B-zy4TOjQrFExssmO34xciDHLCFUCBhQC3Wixto3/pub?gid=0&single=true&output=csv';
        const CONTACT_LINK = 'https://line.me/ti/p/@meanbook';
        const ASSETS_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSboMt8lu6Md3_4KGIZ3QoBCeCO-3RGCg0TVnD4B-zy4TOjQrFExssmO34xciDHLCFUCBhQC3Wixto3/pub?gid=283486066&single=true&output=csv'; 
        
        let allGames = [];
        let filteredGames = [];
        let gameLogoUrl = ''; 
        let currentCardSize = 'normal'; // normal, small, compact
        let currentPage = 1;
        let isShowAll = false; 

        // ระบบเปิด/ปิดเมนูด้านซ้าย
        let isMenuOpen = false;
        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            const sidebar = document.getElementById('sidebarMenu');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (isMenuOpen) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
                // หน่วงเวลาเล็กน้อยเพื่อให้ Transition ทำงานได้สมูท
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                document.body.style.overflow = 'hidden'; // ล็อกไม่ให้หน้าเว็บเลื่อนตอนเปิดเมนู
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
                document.body.style.overflow = ''; // ปลดล็อกหน้าเว็บ
            }
        }

        // ดักจับการย่อ/ขยายหน้าจอเพื่อคำนวณจำนวนคอลัมน์ใหม่ (ป้องกันการกระตุกด้วย setTimeout)
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                if(!isShowAll) renderPaginated();
            }, 150);
        });

        // ฟังก์ชันคำนวณจำนวนคอลัมน์ตามความกว้างหน้าจอ
        function getColumnsCount() {
            const width = window.innerWidth;
            if (currentCardSize === 'normal') {
                if (width >= 1536) return 5;      // 2xl
                if (width >= 1280) return 4;      // xl
                if (width >= 1024) return 3;      // lg
                if (width >= 640) return 2;       // sm
                return 1;                         // mobile
            } else if (currentCardSize === 'small') {
                if (width >= 1280) return 6;
                if (width >= 1024) return 5;
                if (width >= 768) return 4;       // md
                if (width >= 640) return 3;
                return 2;
            } else if (currentCardSize === 'compact') {
                if (width >= 1280) return 8;
                if (width >= 1024) return 6;
                if (width >= 768) return 5;
                if (width >= 640) return 4;
                return 2;
            }
            return 1;
        }

        function formatDriveImageUrl(url) {
            if (!url) return '';
            const driveUrl = url.replace(/"/g, '').trim();
            if (driveUrl.includes('drive.google.com')) {
                let fileId = '';
                if (driveUrl.includes('/file/d/')) {
                    fileId = driveUrl.split('/file/d/')[1].split('/')[0];
                } else if (driveUrl.includes('id=')) {
                    fileId = driveUrl.split('id=')[1].split('&')[0];
                }
                if (fileId) return `https://lh3.googleusercontent.com/u/0/d/${fileId}`;
            }
            return driveUrl;
        }

        async function init() {
            try {
                const assetResponse = await fetch(ASSETS_SHEET_URL);
                if (assetResponse.ok) {
                    const assetData = await assetResponse.text();
                    const assetRows = assetData.split('\n');
                    assetRows.forEach(row => {
                        const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                        const key = cols[0]?.replace(/"/g, '').trim();
                        const value = cols[1]?.replace(/"/g, '').trim();
                        if (key === 'Banner') {
                            const bannerImg = document.getElementById('mainBanner');
                            bannerImg.src = formatDriveImageUrl(value);
                            bannerImg.onload = () => bannerImg.classList.remove('opacity-0');
                            bannerImg.onerror = () => loadDefaultBanner();
                        }
                        if (key === 'BGG Logo') gameLogoUrl = formatDriveImageUrl(value);
                        if (key === 'Favicon') {
                            document.getElementById('dynamic-favicon').href = formatDriveImageUrl(value);
                        }
                    });
                } else { loadDefaultBanner(); }
            } catch (e) { loadDefaultBanner(); }

            try {
                const response = await fetch(SHEET_URL);
                if (!response.ok) throw new Error('Network error');
                const data = await response.text();
                const rows = data.split('\n');
                allGames = rows.slice(1).map((row, index) => {
                    const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return {
                        originalIndex: index,
                        name: cols[2]?.replace(/"/g, '').trim(),
                        img: formatDriveImageUrl(cols[3]),
                        type: cols[4]?.replace(/"/g, '').trim() || '', 
                        lang: cols[7]?.replace(/"/g, '').trim() || '-',
                        manual: cols[8]?.replace(/"/g, '').trim() || 'ไม่มี',
                        price: cols[9]?.replace(/"/g, '').trim(),
                        value: cols[10]?.replace(/"/g, '').trim(),
                        deposit: cols[11]?.replace(/"/g, '').trim(),
                        status: cols[14]?.replace(/"/g, '').trim()
                    };
                }).filter(game => game.name);
                
                applyFilters();
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                renderPaginated();
            }
        }

        function loadDefaultBanner() {
            const bannerImg = document.getElementById('mainBanner');
            bannerImg.src = 'https://via.placeholder.com/1200x500/111/fff?text=Meanbook+Rental+Banner';
            bannerImg.classList.remove('opacity-0');
        }

        function changeCardSize(size) {
            currentCardSize = size;
            document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${size}`).classList.add('active');
            currentPage = 1; // เมื่อเปลี่ยนขนาดให้กลับไปหน้าแรก เพื่อให้จัดแถวได้เต็ม 10 แถวเสมอ
            renderPaginated();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusTerm = document.getElementById('statusFilter').value;
            const sortTerm = document.getElementById('sortFilter').value;
            
            filteredGames = allGames.filter(g => {
                const matchSearch = g.name.toLowerCase().includes(searchTerm);
                const matchStatus = statusTerm === 'all' || (g.status || '').trim() === statusTerm;
                return matchSearch && matchStatus;
            });

            if (sortTerm === 'az') {
                filteredGames.sort((a, b) => a.name.localeCompare(b.name, 'th'));
            } else if (sortTerm === 'za') {
                filteredGames.sort((a, b) => b.name.localeCompare(a.name, 'th'));
            } else if (sortTerm === 'newest') {
                filteredGames.sort((a, b) => b.originalIndex - a.originalIndex);
            }
            
            currentPage = 1; 
            isShowAll = false; 
            renderPaginated();
        }

        function changePage(delta) {
            currentPage += delta;
            renderPaginated();
            document.getElementById('games').scrollIntoView({ behavior: 'smooth' });
        }

        function toggleShowAll() {
            isShowAll = !isShowAll;
            if (!isShowAll) currentPage = 1; 
            renderPaginated();
            document.getElementById('games').scrollIntoView({ behavior: 'smooth' });
        }

        function renderPaginated() {
            const grid = document.getElementById('gamesGrid');
            const noResults = document.getElementById('noResults');
            const paginationContainer = document.getElementById('paginationControls');
            const resultCount = document.getElementById('resultCount');
            
            resultCount.innerText = `พบ ${filteredGames.length} รายการ`;

            if (filteredGames.length === 0) {
                grid.innerHTML = '';
                noResults.classList.remove('hidden');
                paginationContainer.innerHTML = '';
                return;
            }
            noResults.classList.add('hidden');

            // คำนวณจำนวนหน้าแบบไดนามิก (10 แถว * จำนวนคอลัมน์)
            const currentColumns = getColumnsCount();
            const itemsPerPage = currentColumns * 10; 
            
            const totalPages = Math.ceil(filteredGames.length / itemsPerPage);
            if (currentPage > totalPages && totalPages > 0) currentPage = totalPages;

            let gamesToShow = isShowAll ? filteredGames : filteredGames.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);

            let gridClasses = "grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5";
            if (currentCardSize === 'small') gridClasses = "grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6";
            if (currentCardSize === 'compact') gridClasses = "grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8";
            
            grid.className = `grid ${gridClasses} gap-4 md:gap-8`;

            grid.innerHTML = gamesToShow.map(game => {
                const statusStr = (game.status || '').trim();
                const isAvailable = statusStr === 'ว่าง';
                const finalLink = `${CONTACT_LINK}?text=${encodeURIComponent('สนใจเช่า: ' + game.name)}`;
                
                const displayPrice = (!game.price || game.price === '0' || game.price.trim() === '-') ? '-' : game.price + '.-';
                const displayDeposit = (!game.deposit || game.deposit === '0' || game.deposit.trim() === '-') ? '-' : game.deposit + '.-';

                let logoSize = "h-10";
                let padding = "p-6 sm:p-8";
                let titleSize = "text-lg leading-snug";
                let infoTextSize = "text-[13px]";
                let priceBoxPadding = "p-4";
                let btnTextSize = "text-[18px]";
                let btnPadding = "py-4";
                let gapBetweenSections = "mb-5";
                let rentLabel = "ค่าเช่า/วัน"; 

                if (currentCardSize === 'small') {
                    logoSize = "h-8";
                    padding = "p-5";
                    titleSize = "text-base leading-snug";
                    infoTextSize = "text-[11px]";
                    priceBoxPadding = "p-3";
                    btnTextSize = "text-[16px]";
                    btnPadding = "py-3.5";
                    gapBetweenSections = "mb-4";
                    rentLabel = "เช่า/วัน"; 
                } else if (currentCardSize === 'compact') {
                    logoSize = "h-6";
                    padding = "p-4"; 
                    titleSize = "text-sm leading-snug";
                    infoTextSize = "text-[10px]";
                    priceBoxPadding = "p-2.5";
                    btnTextSize = "text-[14px]";
                    btnPadding = "py-3";
                    gapBetweenSections = "mb-3";
                    rentLabel = "เช่า/วัน"; 
                }

                let gameInfoDisplay = '';
                if (currentCardSize === 'normal') {
                    gameInfoDisplay = `เวอร์ชั่น: ${game.lang} | คู่มือ: ${game.manual}`;
                } else {
                    gameInfoDisplay = `เวอร์ชั่น: ${game.lang}<br>คู่มือ: ${game.manual}`;
                }

                let typeDisplay = '';
                if (game.type && game.type.toLowerCase().startsWith('http')) {
                    if (gameLogoUrl) {
                        typeDisplay = `<a href="${game.type}" target="_blank" class="transition-all duration-300 hover:scale-105 active:scale-95 inline-block"><img src="${gameLogoUrl}" class="${logoSize} object-contain opacity-90 hover:opacity-100 transition-opacity" alt="BGG"></a>`;
                    } else {
                        typeDisplay = `<a href="${game.type}" target="_blank" class="${infoTextSize} text-zinc-500 hover:text-white underline truncate max-w-[100px] inline-block font-bold">BGG</a>`;
                    }
                }

                let buttonStyles = '';
                if (statusStr === 'ว่าง') {
                    buttonStyles = 'bg-green-500 text-black hover:bg-green-400 shadow-lg shadow-green-500/20 transition-all duration-300 hover:scale-105 active:scale-95 cursor-pointer';
                } else if (statusStr === 'ติดเช่า') {
                    buttonStyles = 'bg-red-600 text-white cursor-not-allowed pointer-events-none opacity-90 shadow-lg shadow-red-900/20';
                } else if (statusStr === 'กำลังดำเนินการ') {
                    buttonStyles = 'bg-zinc-500 text-white cursor-not-allowed pointer-events-none opacity-90 shadow-lg shadow-zinc-500/20';
                } else {
                    buttonStyles = 'bg-zinc-800 text-zinc-400 cursor-not-allowed pointer-events-none';
                }

                return `
                <div class="glass-card overflow-hidden group flex flex-col shadow-2xl">
                    <div class="aspect-square relative overflow-hidden bg-transparent">
                        <img src="${game.img}" class="w-full h-full object-contain transition-transform duration-1000 group-hover:scale-105" onerror="this.src='https://via.placeholder.com/400x400/111/fff?text=Meanbook'">
                    </div>
                    <div class="${padding} flex flex-col flex-grow">
                        <div class="flex flex-col gap-1.5 mb-3 text-zinc-500 font-bold tracking-widest">
                            <div class="${infoTextSize} uppercase opacity-80">
                                ${gameInfoDisplay}
                            </div>
                            <div class="flex min-h-[20px] items-center">
                                ${typeDisplay}
                            </div>
                        </div>
                        <h3 class="${titleSize} font-bold ${gapBetweenSections} line-clamp-2 overflow-hidden text-zinc-100">${game.name}</h3>
                        
                        <div class="mt-auto">
                            <div class="grid grid-cols-2 gap-2 mb-4">
                                <div class="${priceBoxPadding} rounded-xl bg-white/5 border border-white/5"><p class="${infoTextSize} text-zinc-500 uppercase mb-1 tracking-widest">${rentLabel}</p><p class="${titleSize} font-bold text-white">${displayPrice}</p></div>
                                <div class="${priceBoxPadding} rounded-xl bg-white/5 border border-white/5"><p class="${infoTextSize} text-zinc-500 uppercase mb-1 tracking-widest">มัดจำ</p><p class="${titleSize} font-bold text-white">${displayDeposit}</p></div>
                            </div>
                            <a href="${isAvailable ? finalLink : '#'}" target="_blank" 
                               class="block w-full ${btnPadding} rounded-xl font-black ${btnTextSize} text-center tracking-[0.1em] transition-all ${buttonStyles}">
                                ${statusStr}
                            </a>
                        </div>
                    </div>
                </div>`;
            }).join('');
            lucide.createIcons();

            if (filteredGames.length > itemsPerPage) {
                if (isShowAll) {
                    paginationContainer.innerHTML = `
                        <button onclick="toggleShowAll()" class="px-8 py-4 rounded-2xl bg-white/10 border border-white/20 text-white font-bold tracking-widest uppercase text-sm transition-all hover:bg-white/20 flex items-center shadow-lg">
                            <i data-lucide="layout-grid" class="w-4 h-4 mr-3"></i> กลับไปแบ่งหน้า
                        </button>
                    `;
                } else {
                    paginationContainer.innerHTML = `
                        <div class="flex flex-col md:flex-row items-center gap-4 bg-zinc-900/40 p-2 rounded-[2rem] border border-white/5">
                            <div class="flex items-center gap-2">
                                <button onclick="changePage(-1)" class="px-5 py-3 rounded-2xl bg-white/5 text-white font-bold text-xs transition-all hover:bg-white/10 disabled:opacity-30 disabled:cursor-not-allowed flex items-center" ${currentPage === 1 ? 'disabled' : ''}>
                                    <i data-lucide="chevron-left" class="w-4 h-4 mr-1"></i>
                                </button>
                                <span class="text-zinc-400 font-bold text-xs px-2 whitespace-nowrap">${currentPage} / ${totalPages}</span>
                                <button onclick="changePage(1)" class="px-5 py-3 rounded-2xl bg-white/5 text-white font-bold text-xs transition-all hover:bg-white/10 disabled:opacity-30 disabled:cursor-not-allowed flex items-center" ${currentPage === totalPages ? 'disabled' : ''}>
                                    <i data-lucide="chevron-right" class="w-4 h-4 ml-1"></i>
                                </button>
                            </div>
                            <button onclick="toggleShowAll()" class="px-6 py-3 rounded-2xl bg-white/10 text-white hover:bg-white/20 font-bold text-xs transition-all uppercase tracking-widest">
                                ดูทั้งหมด (${filteredGames.length})
                            </button>
                        </div>
                    `;
                }
                lucide.createIcons();
            } else { paginationContainer.innerHTML = ''; }
        }

        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('sortFilter').addEventListener('change', applyFilters);
        
        // แก้ไขให้โหลดไอคอน Lucide ทันทีตั้งแต่เริ่มต้นเว็บ
        window.onload = () => {
            init();
            lucide.createIcons();
        };
    </script>
</body>
</html>
